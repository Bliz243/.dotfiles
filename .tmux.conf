# ─────────────────────────────────────────────
# Core settings
# ─────────────────────────────────────────────
set -g default-terminal "tmux-256color"
set -sa terminal-overrides ",xterm*:Tc"
set -g mouse on

# Prefix: C-a
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Windows/panes start at 1
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on

# Sensible defaults
set -s escape-time 0
set -s extended-keys always
set -as terminal-features 'xterm*:extkeys'
set -g allow-passthrough on
set -g history-limit 50000
set -g display-time 4000
set -g status-interval 5

# ─────────────────────────────────────────────
# Pane navigation (vim-style)
# ─────────────────────────────────────────────
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Alt-arrow without prefix
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# ─────────────────────────────────────────────
# Window navigation
# ─────────────────────────────────────────────
bind -n S-Left previous-window
bind -n S-Right next-window
bind -n M-H previous-window
bind -n M-L next-window

# ─────────────────────────────────────────────
# Splits (keep current path)
# ─────────────────────────────────────────────
bind '"' split-window -v -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"

# ─────────────────────────────────────────────
# Copy mode (vi) and mouse selection
# ─────────────────────────────────────────────
set-window-option -g mode-keys vi
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# Mouse selection copies to clipboard
set -g @yank_selection_mouse 'clipboard'

# Double-click to select word, triple-click to select line
bind -T copy-mode-vi DoubleClick1Pane select-pane \; send-keys -X select-word
bind -T copy-mode-vi TripleClick1Pane select-pane \; send-keys -X select-line
bind -n DoubleClick1Pane select-pane -t = \; if-shell -F "#{||:#{pane_in_mode},#{mouse_any_flag}}" { send-keys -M } { copy-mode -H ; send-keys -X select-word }
bind -n TripleClick1Pane select-pane -t = \; if-shell -F "#{||:#{pane_in_mode},#{mouse_any_flag}}" { send-keys -M } { copy-mode -H ; send-keys -X select-line }

# Drag to select (auto-copies on release via tmux-yank)
bind -n MouseDrag1Pane if-shell -F "#{||:#{pane_in_mode},#{mouse_any_flag}}" { send-keys -M } { copy-mode -H }

# Shift+click bypasses tmux (native terminal selection)
# This works automatically in most terminals - hold Shift while selecting

# ─────────────────────────────────────────────
# Utilities
# ─────────────────────────────────────────────
bind R source-file ~/.tmux.conf \; display "Config reloaded!"
bind x kill-pane

# ─────────────────────────────────────────────
# Plugins
# ─────────────────────────────────────────────
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'catppuccin/tmux#v2.1.3'

# ─────────────────────────────────────────────
# Catppuccin Theme
# ─────────────────────────────────────────────
set -g @catppuccin_flavor 'mocha'

# Window styling
set -g @catppuccin_window_status_style 'rounded'
set -g @catppuccin_window_number_position 'left'
set -g @catppuccin_window_default_fill 'number'
set -g @catppuccin_window_default_text '#W'
set -g @catppuccin_window_current_fill 'number'
set -g @catppuccin_window_current_text '#W'

# Status bar position
set -g status-position bottom
set -g status-justify left

# Status left: session name
set -g status-left-length 100
set -g status-left "#{E:@catppuccin_status_session} "

# Status right: directory (full path with ~ for home)
set -g status-right-length 100
set -g @catppuccin_directory_text "#{s|$HOME|~|:pane_current_path}"
set -g status-right "#{E:@catppuccin_status_directory}"

# Initialize TPM (keep at bottom)
run '~/.tmux/plugins/tpm/tpm'
